<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>TFG</title>
<link href="https://waloncab.github.io/s.ln_blog/assets/css/body.css" rel="stylesheet"/>
<link href="./style.css" rel="stylesheet"/>
<link href="./codehilite.css" rel="stylesheet"/>
<script type="module">
  import mermaid from 'https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>
</head>
<body>
<div class="content">
<ul><li><a href="#TFG">TFG</a></li><ul><li><a href="#resumen">resumen</a></li><li><a href="#0-intro">0-intro</a></li><ul><li><a href="#contexto">contexto</a></li><li><a href="#previos">previos</a></li><li><a href="#justificación">justificación</a></li></ul><li><a href="#0-plan">0-plan</a></li><ul><li><a href="#alcance">alcance</a></li><li><a href="#metodología">metodología</a></li><li><a href="#EDT">EDT</a></li><li><a href="#entregables">entregables</a></li><li><a href="#tiempos">tiempos</a></li><li><a href="#gantt">gantt</a></li><li><a href="#rrhh">rrhh</a></li><li><a href="#comunicaciones">comunicaciones</a></li><li><a href="#riegos">riegos</a></li></ul><li><a href="#0-analisis">0-analisis</a></li><ul><li><a href="#AGRAI-data">AGRAI-data</a></li><li><a href="#ideas-previas">ideas-previas</a></li><li><a href="#automatizacion">automatizacion</a></li><li><a href="#tecnologías">tecnologías</a></li><li><a href="#requisitos">requisitos</a></li></ul><li><a href="#0-infraestructura">0-infraestructura</a></li><ul><li><a href="#infraestructure">infraestructure</a></li><li><a href="#entorno">entorno</a></li><li><a href="#UNIX">UNIX</a></li><li><a href="#control-versiones">control-versiones</a></li></ul><li><a href="#0-diseño">0-diseño</a></li><ul><li><a href="#componentes">componentes</a></li><li><a href="#data-load">data-load</a></li><li><a href="#modelo-BD">modelo-BD</a></li><li><a href="#services">services</a></li><li><a href="#despliegue">despliegue</a></li></ul><li><a href="#0-implementacion">0-implementacion</a></li><ul><li><a href="#previos-pipe">previos-pipe</a></li><li><a href="#commands-CLI">commands-CLI</a></li><li><a href="#model-view">model-view</a></li><li><a href="#modelo-producción">modelo-producción</a></li></ul><li><a href="#0-seguimiento">0-seguimiento</a></li><ul><li><a href="#seguimiento">seguimiento</a></li><li><a href="#memoria">memoria</a></li><li><a href="#lecciones">lecciones</a></li></ul><li><a href="#0-conclusiones">0-conclusiones</a></li><ul><li><a href="#conclusiones">conclusiones</a></li><li><a href="#bibliografía">bibliografía</a></li></ul></ul></ul>
<div id="TFG"><h1>1</h1>b'<p>-- LINK_NOTE --</p>\n<p>[[resumen]]</p>\n<p>[[0-intro]]</p>\n<p>[[0-plan]]</p>\n<p>[[0-analisis]]</p>\n<p>[[0-infraestructura]]</p>\n<p>[[0-diseo]]</p>\n<p>[[0-implementacion]]</p>\n<p>[[0-seguimiento]]</p>\n<p>[[0-conclusiones]]</p>'</div><div id="resumen"><h2>2</h2>b'<p>Pipeline de Datos para una Aplicacin de datosAgroalimentarios.</p>\n<p>Resumen: El trabajo consistir en la reestructuracin de una aplicacin de gestin de datos agroalimentarios con el objetivo de soportar la gestin y el mantenimiento de los datos de diferentes clientes. Estos datos, actualmente, se actualizan e incrementan de forma peridica con un aadido de trabajo manual que se puede optimizar mediante tcnicas de integracin y despliegue continuo.</p>'</div><div id="0-intro"><h2>2</h2>b'<p>[[contexto]]</p>\n<p>[[previos]]</p>\n<p>[[justificacin]]</p>'</div><div id="contexto"><h3>3</h3>b'<p>El propsito de este proyecto es mejorar el flujo de trabajo del equipo de "SpectralGeo" mediante la automatizacin del proceso de recogida y procesado de datos agronmicos que se utilizan en la creacin de modelos de inteligencia artificial.</p>\n<p>AGRAIes una aplicacin para la gestin de cultivos que permite al agricultor monitorizar el estado de sus parcelas. El estado actual de la aplicacin se centra el despliegue de datos agronmicos y vegetativosgeoreferenciadosa travs de en una interfaz web. Los usuarios de la aplicacin, normalmente agricultores o cooperativas, pueden consultar el estado de su parcelario junto con algunas predicciones. El acceso a dicha aplicacin puede darse desde equipo de sobremesa o un dispositivo mvil, aunque es este ltimo lo que parece que se utiliza ms. </p>\n<p><img alt="caption" src="figures/visor_GIS_det.png"/></p>\n<p>Actualmente, cmo se procesa la informacin que utiliza nuestra aplicacin es un proceso tedioso para el equipo. En este proceso, diferentes miembros trabajan contecnologasdistintas sobre datos duplicados provenientes de fuentes comunes. Aunque se realiza una planificacin y coordinacin de los proyectos, se pierde bastante tiempo en la transformacin de los datos que cada miembro del equipo necesita para llevar a cabo su labor.</p>\n<p>El objetivo de este Trabajo de Fin de Grado (TFG) es mejorar y automatizar el flujo de trabajo del equipo, convirtiendo la aplicacin AGRAI en una herramienta robusta que manipule un nico repositorio de datos al cual el resto del equipo pueda acceder, utilizar de forma segura y lo ms importante, sin duplicar y romper la integridad de estos datos.</p>\n<p>Entiendo que es un proyecto ambicioso debido a que no solo es importante el conocimiento tcnico, sino que sern necesarios cambios en la forma de trabajo del equipo, adems de la confianza de cada miembro por la nueva forma de trabajo que se desea implementar. </p>'</div><div id="previos"><h3>3</h3>b'<p>SpectralGeo se ha especializado en el uso de nuevas tecnologas para sectores como el de la agricultura o el reciclaje, centrndose en proyectos con carcter reivindicativo por la sostenible medioambiental. La relacin con clientes como Ecoembes o el desarrollo de software para la gestin sostenible de cultivos lo demuestran.</p>\n<p>Durante las prcticas realizas en la empresa identifiqu que era totalmente necesario dotar de una arquitectura robusta a la aplicacin sobre la que trabajaba gran parte del equipo. Adems de adaptarme a las tecnologas necesarias para la ciencia de datos actual al que todo el mundo se est sumando, comenc con la implementacin de un modelo sobre el que la aplicacin AGRAI pudiese escalarse posteriormente.</p>\n<p>La aplicacin ya est creada, el cliente obtiene los resultados que espera cuando consulta el estado de su parcelario en la interfaz de la aplicacin. Como equipo nos organizamos para que la informacin y los modelos predictivos lleguen al cliente a travs de esta, pero son varios los puntos en los que trabajamos en exceso para finalmente mostrar una "prediccin" al cliente. Sern las etapas de extraccin, pre-procesado, procesado y modelado las que buscaremos optimizar en el contexto de todo el equipo, debido a que estas etapas se reparten entre sus miembros.</p>\n<p><img alt="caption" src="figures/lean_1.gif"/></p>\n<p>Justificamos este cambio como parte de una bsqueda de procesos esbeltos (lean), que consisten en la eliminacin de los "desperdicios", o fuentes de despilfarro de tiempo y trabajo en la elaboracin de productos o servicios. A travs de la solucin que vamos a implantar buscamos la optimizacin continua del proceso y la aceptacin de dicha cultura de optimizacin por el equipo.</p>\n<p>Los puntos ms importantes de los procesos "lean" son los siguientes:</p>\n<ul>\n<li>identificar los desperdicios y tratar de eliminarlos</li>\n<li>mejorar la comunicacin interna de la organizacin</li>\n<li>reducir costes y tiempos de entrega y mejorar la calidad</li>\n</ul>'</div><div id="justificación"><h3>3</h3>b'<ul>\n<li>partimos de un rediseo de BD anterior.</li>\n<li>buscamos automatizar los modelos de produccin ()</li>\n<li>necesitamos una arquitectura limpia.</li>\n</ul>\n<p>Necesidad de una reestructuracin para la aplicacin Agrai por su crecimiento para la gestin de grandes volmenes de datos agrarios con especial nfasis en los ndices vegetativos provenientes del procesamiento de imgenes satelitales. El estado actual de dicha aplicacin consiste en la representacin del estado de cierto parcelario a travs del anlisis de histricos de datos.</p>'</div><div id="0-plan"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[alcance]]</p>\n<p>[[metodologa]]</p>\n<p>[[EDT]]</p>\n<p>[[entregables]]</p>\n<p>[[tiempos]]</p>\n<p>[[gantt]]</p>\n<p>[[rrhh]]</p>\n<p>[[comunicaciones]] </p>\n<p>[[riegos]]</p>'</div><div id="alcance"><h3>3</h3>b'<p>El proyecto planteado inicialmente por la empresa tiene una planificacin de cuatro meses. </p>\n<p>A continuacin, se expondrn los objetivos generales del proyecto con la intencin de aportar una visin global del trabajo que se pretende realizar. Para evaluar el xito de la realizacin de mi TFG se plantear en la fase de anlisis de cada iteracin unos requisitos a partir de los cules se podr valorar el desarrollo de mi TFG y la influencia que tendr mi aportacin en el proyecto final.</p>\n<p>Los objetivos finales del proyecto son:</p>\n<ul>\n<li>Automatizar el despliegue de la aplicacin mediante infraestructura como cdigo.</li>\n<li>Disear un modelo de datos que permita un rpido escalado de dicha aplicacin.</li>\n<li>Automatizar el proceso de trasformacin de los datos mediante el diseo de un pipeline.</li>\n<li>Obtener un modelo de produccin de cultivo para el parcelario (kg)</li>\n<li>Incluir los resultados en la presentacin de la aplicacin.</li>\n<li>Realizar un proceso de integracin continua mediante pruebas de test para el pipeline desarrollado</li>\n</ul>'</div><div id="metodología"><h3>3</h3>b'<p>En el equipo hacemos uso de SCRUM para la gestin del proyecto. Dicha metodologa permite un desarrollo en cascada de las diferentes tareas propuestas para la creacin del pipeline.</p>\n<p>Se usar un ciclo de vida iterativo e incremental. Dentro de las fases del proyecto (tambin llamadas iteraciones), se repiten de manera intencionada una o ms actividades del<br/>\nproyecto. Con estas iteraciones el entendimiento del producto por parte del equipo va  aumentando. Las fases (iteraciones) desarrollan el producto a travs de una serie de ciclos repetidos, mientras que los incrementos van aadiendo sucesivamente funcionalidad al<br/>\nproducto. En definitiva, consiste en varios ciclos de vida en cascada. Al final de cada iteracin se entrega una versin mejorada.</p>\n<p><img alt="caption" src="figures/iteraciones.png" title="title"/></p>'</div><div id="EDT"><h3>3</h3>b'<p>Mostramos el desglose de las tareas ms importantes para la correcta realizacin del proyecto.</p>\n<div class="mermaid">\ngraph LR;\nTFG--&gt;PLANIFICACIN;\nTFG--&gt;ANLISIS;\nTFG--&gt;DISEO;\nTFG--&gt;IMPLEMENTACIN;\nPLANIFICACIN--&gt;ALCANCE;\nPLANIFICACIN--&gt;METODOLOGIA;\nPLANIFICACIN--&gt;EDT;\nPLANIFICACIN--&gt;ENTREGABLES;\nPLANIFICACIN--&gt;TIEMPOS;\nPLANIFICACIN--&gt;GANTT;\nPLANIFICACIN--&gt;RRHH;\nPLANIFICACIN--&gt;COMUNICACIONES;\nPLANIFICACIN--&gt;RIESGOS;\nANLISIS--&gt;PREVIOS;\nANLISIS--&gt;REQUISITOS;\nREQUISITOS--&gt;FUNCIONALES:\nREQUISITOS--&gt;NO_FUNCIONALES;\nDISEO--&gt;ARQUITECTURA;\nIMPLEMENTACIN--&gt;PIPELINE;\nPIPELINE--&gt;PIPE.1_D;\nPIPELINE--&gt;PIPE.2_D;\n</div>\n\n<h2>Tareas y Descripcin:</h2>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.1 INTRODUCCIN</td>\n<td>Explicamos el contexto del problema planteado y cmo vamos a implementar la solucin.</td>\n</tr>\n<tr>\n<td>1.2 ALCANCE</td>\n<td>Qu pretendemos conseguir con el proyecto acontando las tareas</td>\n</tr>\n<tr>\n<td>1.3 RECURSOS HUMANOS</td>\n<td>Aquellas personas que intervienen y la explicacin de sus funciones</td>\n</tr>\n<tr>\n<td>1.4 COMUNICACIONES</td>\n<td>Elementos de comunicacin interna y externa, incluimos interesados y clientes.</td>\n</tr>\n<tr>\n<td>1.5 METODOLOGIA</td>\n<td>Conjunto de procedimientos que usaremos para la planificacin y gestin.</td>\n</tr>\n<tr>\n<td>1.6 EDT</td>\n<td>Estructura en rbol con el desglose en tareas del trabajo</td>\n</tr>\n<tr>\n<td>1.7 ENTREGABLES</td>\n<td>Creacin de los paquetes de trabajo del proyecto</td>\n</tr>\n<tr>\n<td>1.8 ESTIMACIN DE TIEMPOS</td>\n<td>Estimancin en horas para cada paquete de trabajo</td>\n</tr>\n<tr>\n<td>1.9 GANTT</td>\n<td>Tiempo determinado en el calendario para cada uno de los paquetes de trabajo</td>\n</tr>\n<tr>\n<td>1.10 PLAN DE RIESGOS</td>\n<td>Determinaremos los principales riesgos que pueden suceder durante el proyecto y los categorizaremos por nivel de impacto y de suceso.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2.1 CONCEPTOS PREVIOS</td>\n<td>Explicamos el contexto del problema planteado y cmo vamos a implementar la solucin.</td>\n</tr>\n<tr>\n<td>2.2 PROYECTO AGRAI</td>\n<td>Presentamos el estado actual de la aplicacin AGRAI.</td>\n</tr>\n<tr>\n<td>2.3 PIPELINE</td>\n<td>Exponemos los distintos pasos a travs de los cuales se transforman los datos</td>\n</tr>\n<tr>\n<td>2.4 CATLOGO DE REQUISITOS</td>\n<td>Obtendremos los requisitos funcionales y no funcionales del proyecto</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3.1 ENTORNO</td>\n<td>Decidimos los entornos de desarrollo necesarios as como las tecnologas necesarias en cada punto.</td>\n</tr>\n<tr>\n<td>3.2 INFRAESTRUCTURA CDIGO</td>\n<td>Desarrollamos un script para dejar la mquina que contiene la aplicacin en un estado estable con todas sus dependencias instaladas.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>4.1 ANLISIS MODELO PREVIO</td>\n<td>Explicamos el contexto del modelo de datos previos y sus fallos</td>\n</tr>\n<tr>\n<td>4.2 REDISEO ENTIDADES</td>\n<td>Explicamos qu entidades conformarn el modelo y por que la base de datos quedar normalizada.</td>\n</tr>\n<tr>\n<td>4.3 DISEO DE SERVICIOS</td>\n<td>Encapsulamos las consultas ms frecuentes en servicios fciles de acceder.</td>\n</tr>\n<tr>\n<td>4.4 CARGA CON DATOS</td>\n<td>Cargaremos el modelo con datos para verificar su consistencia.</td>\n</tr>\n<tr>\n<td>4.5 DESPLIEGUE DE APLICACIN</td>\n<td>Obtendremos los requisitos funcionales y no funcionales del proyecto</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>5.1 DATOS DE ENTRADA</td>\n<td>Explicamos las fuentes de datos con las que trabajamos</td>\n</tr>\n<tr>\n<td>5.2 DEFINICIN DE ETAPAS</td>\n<td>Acotamos y definimos los pasos en los que se transforman los datos hasta llegar al modelo de forma consistente.</td>\n</tr>\n<tr>\n<td>5.3 VISTA MINABLE</td>\n<td>Con los datos ordenados en el modelo seleccionamos \'features\' para el modelo de produccin</td>\n</tr>\n<tr>\n<td>5.4 MODELO DE PRODUCCIN</td>\n<td>Usamos varias tcnicas de Inteligencia Artificial para crear un modelo de produccin de Kg para el cultivo.</td>\n</tr>\n<tr>\n<td>5.4 AUTOMATIZACIN COMPLETA</td>\n<td>Explicamos cmo esta definicin e implementacin de etapas permite automatizar el flujo de trabajo del equipo.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>6.1 PRUEBAS</td>\n<td>Realizamos pruebas de integracin para asegurar la consistencia de los datos</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>7.1 ESTUDIO PREVIO</td>\n<td>Se revisarn y observarn TFGs de aos anteriores, los cuales podemos encontrar en la biblioteca de la Universidad de La Rioja.</td>\n</tr>\n<tr>\n<td>7.2 ESTRUCTURA</td>\n<td>Disearemos la estructura de nuestro TFG basndonos en la estructura de otros trabajos de compaeros.</td>\n</tr>\n<tr>\n<td>7.3 REDACCIN</td>\n<td>Redactamos la memoria a medida que avanza el proyecto.</td>\n</tr>\n<tr>\n<td>7.4 EXPORTACIN</td>\n<td>La memoria se escribe en notas de "markdown" debido a la simplicidad con la que se pueden integrar diagramas y cdigo. Al terminarl, exportaremos la memoria como pginal "html"</td>\n</tr>\n<tr>\n<td>7.5 REVISIN</td>\n<td>Al finalizar el proyecto revisaremos el escrito para asegurarnos de no cometer errores.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>Tarea</th>\n<th>Descripcin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>8.1 GESTIN DE TIEMPOS</td>\n<td>En una tabla registramos el tiempo estimado, el tiempo real invertido y la desviacin del tiempo en cada una de las tareas del proyecto.</td>\n</tr>\n<tr>\n<td>8.2 REUNIONES</td>\n<td>Se realizarn rdenes del da y actas con lo tratado en cada una de las reuniones.</td>\n</tr>\n</tbody>\n</table>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="entregables"><h3>3</h3>b'<p>Para acotar el proceso de trabajo identificamos los siguientes entregables que generaremos a lo a medida que avance el proyecto. Estos entregables quedarn en la memoria en sus correspondientes apartados o como anexos si tienen una extensin ms larga. La siguiente tabla contiene que lleva a cada uno de estos artefactos.</p>\n<table>\n<thead>\n<tr>\n<th align="left">IDENT</th>\n<th align="right">ENTREGABLE</th>\n<th align="center">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/alesteba/tfg/tree/main/entregables/pipeline">E01</a></td>\n<td align="right">Mdulo de Inicio</td>\n<td align="center">Anlisis de viabilidad que permitir determinar si es posible desarrollar el proyecto.</td>\n</tr>\n<tr>\n<td align="left">[E02]</td>\n<td align="right">Planificacin del proyecto</td>\n<td align="center">Determinaremos los requisitos del proyecto, crearemos un enunciado para el alcance, realizaremos una descripcin detallada de tareas junto a una EDT, estimaremos el tiempo y costo de los paquetes de trabajo, desarrollaremos un cronograma, estableceremos los estndares, procesos y mtricas de calidad, determinaremos un plan de identificacin de riesgos y crearemos el plan de gestin de cambios.</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/alesteba/tfg/tree/main/entregables/pipeline">E03</a></td>\n<td align="right">Infraestructura como cdigo</td>\n<td align="center">Desarrollo de un \'script\' con las instrucciones bash para dejar la mquina que despliega la aplicacin en un estado estable.</td>\n</tr>\n<tr>\n<td align="left">[E04]</td>\n<td align="right">Documento de Diseo</td>\n<td align="center">Documento en el que se explican las decisiones tomadas para la creacin de las entidades del modelo y sus relaciones.</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/alesteba/tfg/tree/main/entregables/models.py">E05</a></td>\n<td align="right">Esquema modelo de Datos</td>\n<td align="center">Esquema UML que representa las entidades del modelo y sus relaciones. Modelo simplificado de datos exraido del ORM Django</td>\n</tr>\n<tr>\n<td align="left">[E06]</td>\n<td align="right">Arquitectura Pipeline</td>\n<td align="center">Arquitectura y diagramas del proceso de transformacin de datos, junto con sus scripts.</td>\n</tr>\n<tr>\n<td align="left">[E07]</td>\n<td align="right">Vista minable</td>\n<td align="center">Estructura tabulada con las \'features\' necesarias para el modelo de produccin de cultivo.</td>\n</tr>\n<tr>\n<td align="left">[E08]</td>\n<td align="right">Modelo de produccin</td>\n<td align="center">Cuaderno jupyter en el que buscamos el mejor modelo posible</td>\n</tr>\n<tr>\n<td align="left">[E09]</td>\n<td align="right">Interfaz de usuario</td>\n<td align="center">Entregable donde crearemos un apartado en la aplicacin web AGRAI para mostrar las predicciones del modelo creado.</td>\n</tr>\n</tbody>\n</table>'</div><div id="tiempos"><h3>3</h3>b"<p>Para poder realizar un posterior seguimiento y control del proyecto asignamos a cada tarea un tiempo adecuado a la complejidad que estimamos para sta. En caso de que posteriormente nos alejemos de lo que aqu planificamos, anotaremos dichas desviaciones en la seccin de 'seguimiento y control'</p>\n<table>\n<thead>\n<tr>\n<th>V</th>\n<th>Tarea</th>\n<th>Horas</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.0</td>\n<td>DOP</td>\n<td>10</td>\n</tr>\n<tr>\n<td>1.1</td>\n<td>INTRODUCCIN</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.2</td>\n<td>ALCANCE</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.3</td>\n<td>RECURSOS HUMANOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.4</td>\n<td>COMUNICACIONES</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.5</td>\n<td>METODOLOGIA</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.6</td>\n<td>EDT</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.7</td>\n<td>ENTREGABLES</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.8</td>\n<td>ESTIMACIN DE TIEMPOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.9</td>\n<td>GANTT</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1.10</td>\n<td>PLAN DE RIESGOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2.0</td>\n<td>ANLISIS</td>\n<td>10</td>\n</tr>\n<tr>\n<td>2.1</td>\n<td>CONCEPTOS PREVIOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2.2</td>\n<td>PROYECTO AGRAI</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2.3</td>\n<td>PIPELINE</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2.4</td>\n<td>CATLOGO DE REQUISITOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3.0</td>\n<td>DISE0</td>\n<td>10</td>\n</tr>\n<tr>\n<td>3.1</td>\n<td>ANLISIS MODELO PREVIO</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3.2</td>\n<td>REDISEO ENTIDADES</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3.3</td>\n<td>CARGA CON DATOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3.4</td>\n<td>DESPLIEGUE DE APLICACIN</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3.4</td>\n<td>PIPELINE</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4.0</td>\n<td>IMPLEMENTACIN</td>\n<td>10</td>\n</tr>\n<tr>\n<td>4.1</td>\n<td>DATOS DE ENTRADA</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4.2</td>\n<td>DEFINICIN DE ETAPAS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4.3</td>\n<td>VISTA MINABLE</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4.4</td>\n<td>MODELO DE PRODUCCIN</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4.4</td>\n<td>AUTOMATIZACIN COMPLETA</td>\n<td>1</td>\n</tr>\n<tr>\n<td>5.0</td>\n<td>PRUEBAS</td>\n<td>10</td>\n</tr>\n<tr>\n<td>5.1</td>\n<td>PRUEBAS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>6.0</td>\n<td>MEMORIA</td>\n<td>10</td>\n</tr>\n<tr>\n<td>6.1</td>\n<td>ESTUDIO PREVIO</td>\n<td>1</td>\n</tr>\n<tr>\n<td>6.2</td>\n<td>ESTRUCTURA</td>\n<td>1</td>\n</tr>\n<tr>\n<td>6.3</td>\n<td>REDACCIN</td>\n<td>1</td>\n</tr>\n<tr>\n<td>6.4</td>\n<td>REVISIN</td>\n<td>1</td>\n</tr>\n<tr>\n<td>7.0</td>\n<td>SEGUIMIENTO Y CONTROL</td>\n<td>10</td>\n</tr>\n<tr>\n<td>7.1</td>\n<td>GESTIN DE TIEMPOS</td>\n<td>1</td>\n</tr>\n<tr>\n<td>7.2</td>\n<td>REUNIONES</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>"</div><div id="gantt"><h3>3</h3>b'<p>https://gist.github.com/martinwoodward/8ad6296118c975510766d80310db71fd</p>\n<p>El siguiente diagrama propone un desglose de tareas para la planificacin del proyecto. </p>\n<div class="mermaid">\ngantt\ntitle Planificacin\ndateFormat  DD-MM\naxisFormat  %d\n\nsection ANALISIS\nALCANCE: done, 01-01, 2d\nMETODOLOGIA: crit, 02-01, 3d\nEDT: 03-01, 5d\nGANNT: 04-01, 5d\nRRHH: 05-01, 3d\nCOMUNICACIONES: 06-01, 5d\nRIESGOS: 07-01, 5d\n\nsection MODELO_DATOS\nRELACIONES BD: done, 08-01, 15d\nREDISEO: crit, 09-01, 15d\n\nsection ENTORNO\nDJANGO+JUPYTER: done, 10-01, 2d\nINT_CONTINUA: crit, 11-01, 3d\n\nsection PIPELINE\nINFR: 20-01, 5d\nLOAD: 21-01, 5d\nFEAT: 25-01, 5d\nVIEW: 25-01, 7d\nMODEL: 30-01, 7d\nWEB: 30-01, 5d\nPhase 2 complete: milestone, 30-01, 0d\n\nsection TEST\nTEST 1: 20-01, 30d\nTEST 2: 30-01, 20d\nTEST 3: milestone, 20-02, 1d\n\nsection MEMORIA\nMEM_WRITE: 01-01, 60d\nSEG_Y_CONT: 01-01, 60d\n\n\nProject complete: milestone, 10-03, 0d\n</div>\n\n<p>Este diagrama es una estipulacin de cmo creo que voy a ir durante el desarrollo del modelo de datos y del pipeline correspondiente. En la seccin final de seguimiento y control analizamos las desviaciones encontradas y cmo han sido solucionados estos contratiempos.</p>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="rrhh"><h3>3</h3>b'<p>El personal implicado en el Trabajo de Fin de Grado ser:  </p>\n<table>\n<thead>\n<tr>\n<th align="left">INTERESADO</th>\n<th align="center">LABOR</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Alberto Esteban Larreina</td>\n<td align="center">Ejecutor y responsable del proyecto. Desarrollar el proyecto en su totalidad</td>\n</tr>\n<tr>\n<td align="left">Antonio Rbio</td>\n<td align="center">Tutor en la empresa. Se dedicar a corregir los aspectos tcnicos del proyecto referentes al desarrollo  del mismo y planificacin.</td>\n</tr>\n<tr>\n<td align="left">Jnathan Heras</td>\n<td align="center">Tutor acadmico. Se dedicar a corregir aspectos referentes a la documentacin y la forma en la que se desarrollar el proyecto a lo largo del tiempo estipulado y me guiar a cerca del desarrollo de este.</td>\n</tr>\n</tbody>\n</table>'</div><div id="comunicaciones"><h3>3</h3>b'<p>Para mantener informados tanto al tutor acadmico como a la tutora de la empresa, utilizaremos los siguientes canales:  </p>\n<table>\n<thead>\n<tr>\n<th align="left">CANAL</th>\n<th align="right">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Reuniones</td>\n<td align="right">presenciales, tanto con el tutor acadmico como con el tutor de la empresa.</td>\n</tr>\n<tr>\n<td align="left">Email</td>\n<td align="right">se utilizar como forma de comunicacin electrnica para concretar determinadas pautas o establecimiento de citas.</td>\n</tr>\n<tr>\n<td align="left">Discord</td>\n<td align="right">aplicacin de comunicacin interna para mensajes directos con los miembros del equipo.</td>\n</tr>\n</tbody>\n</table>'</div><div id="riegos"><h3>3</h3>b'<p>El objetivo de esta tabla es aumentar la probabilidad de eventos positivos y disminuir la de los negativos.</p>\n<table>\n<thead>\n<tr>\n<th align="left">FUENTE</th>\n<th align="center">RIESGO</th>\n<th align="center">SI SUCEDE</th>\n<th align="center">MINIMIZAR</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Ausencia de interesados</td>\n<td align="center">Mdio</td>\n<td align="center">this is centered</td>\n<td align="center">this is centered</td>\n</tr>\n<tr>\n<td align="left">Ausencia del Tutor</td>\n<td align="center">these will be justified</td>\n<td align="center">this is centered</td>\n<td align="center"></td>\n</tr>\n<tr>\n<td align="left">Tecnologa equivocada</td>\n<td align="center">Medio</td>\n<td align="center">Estudiar nuevas posiblidades</td>\n<td align="center">Uso de patrones abstractos elegantes que se puedan implementar en diferentes frameworks</td>\n</tr>\n<tr>\n<td align="left">Prdida cdigo fuente</td>\n<td align="center">Alto</td>\n<td align="center">Empezar casi de cero</td>\n<td align="center">Backups y control de versiones</td>\n</tr>\n<tr>\n<td align="left">Prdida documentacin</td>\n<td align="center">Alto</td>\n<td align="center">Empezar casi de cero</td>\n<td align="center">Utilizar herramientas de copias incrementales</td>\n</tr>\n<tr>\n<td align="left">Fallo del servidor con la applicacin</td>\n<td align="center">Alto</td>\n<td align="center">Utilizar y configurar uno nuevo</td>\n<td align="center">Backups</td>\n</tr>\n<tr>\n<td align="left">Falta de horas para terminar el proyecto</td>\n<td align="center">Medio</td>\n<td align="center">Dedicarse primero a los requisitos ms importantes.</td>\n<td align="center">Realizar una buena planificacin y ajustar el alcance</td>\n</tr>\n</tbody>\n</table>\n<p>De la tabla anterior se prestar especial atencin a los riesgos valorados como \'Alto\', ya que por su incidencia en el proyecto requieren un seguimiento exhaustivo, para los cuales se desarrollarn sus correspondientes planes de contingencia.  </p>\n<p>Los riesgos de valoracin Media y Baja tendrn un control basado en su plan de mitigacin simple de seguimientos al cronograma, con intervalos cortos de tiempo.</p>'</div><div id="0-analisis"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[AGRAI-data]]</p>\n<p>[[ideas-previas]]</p>\n<p>[[automatizacion]]</p>\n<p>[[tecnologas]]</p>\n<p>[[requisitos]]</p>'</div><div id="AGRAI-data"><h3>3</h3>b'<p>AGRAIes una aplicacin para la gestin de cultivo que permite al agricultor monitorizar el estado de sus parcelas. El estado actual de la aplicacin se centra el despliegue de datosgeo-referenciadospor medio de una interfaz web. Los resultados para el usuario de la aplicacin son satisfactorios permitiendo a ste consultar el estado de su parcelario junto con algunas predicciones en cualquier momento. </p>\n<p>En la interfaz web el cliente observa un mapa con sus parcelas resaltadas en colores. Este color reflejado en  los pxeles hace referencia a los ndices vegetativos provenientes de las imgenes satelitales. Los clientes utilizan dicha interfaz para ver el estado de sus cultivos y observar la produccin que predicen los modelos de Inteligencia Artificial generados.</p>\n<p><img alt="caption" src="figures/visor_GIS.png"/></p>\n<p>A nivel interno, el equipo trabaja con datos provenientes de imgenes descargadas de satlites como SENTINEL, o de grabaciones realizadas por dron cuando se requiere una mayor calidad. Estos datos se mezclan con informacin proporcionada por estaciones meteorolgicas como el SIAR y con la informacin que los clientes pueden proporcionar sobre campaas anteriores.</p>\n<p>Por otro lado, cmo actualmente se procesa la informacin es un proceso tedioso para el equipo. Los diferentes miembros trabajan contecnologasdistintas sobre datos muchas veces duplicados que provienen de fuentes comunes.</p>\n<p>El objetivo de este trabajo de fin de grado es mejorar y automatizar el flujo de trabajo del equipo convirtiendo la aplicacin AGRAI en una herramienta robusta que manipule un nico repositorio de datos al cul el resto del equipo pueda acceder y utilizar de forma segura y lo ms importante, sin duplicar y romper la integridad de los datos.</p>\n<p>Entiendo que es un proyecto ambicioso debido a que no slo es importante el conocimiento tcnico sino que sern necesarios cambios en la forma de trabajo del equipo adems de la confianza de cada miembro por la nueva forma de trabajo que se desea implementar. Intentaremos seguir los principios de los procesos \'lean\' para buscar la mejor optimizacin continua.</p>\n<p><img alt="caption" src="figures/lean.png" title="title"/></p>'</div><div id="ideas-previas"><h3>3</h3>b'<p>Mencionbamos la bsqueda de optimizacin del proceso como una de las principales idea para mejorar el flujo de datos que utiliza la aplicacin. El rediseo que se quiere implantar y la arquitectura resultante tiene que cumplir con los principios de dicha metodologa. Para que este trabaja resulte satisfactorio, el software tiene que poder utilizarse por el equipo con agilidad, consiguiendo que quede como una herramienta fsica que coordine el esquema mental de los participantes que la usan.</p>\n<p>Para poder realizar este proyecto decidimos trabajar con un nmero pequeo representativo de datos de laaplicacinactualmente en produccin. Un menor volumen de informacin permite realizar pruebas y da pie a fijarnos en las relaciones y los esquemas estructurales con ms precisin.  </p>\n<p>Como este trabajo se realiza en equipo, a medida que voy haciendo pruebas con mi entorno local, un compaero se encarga de ir probando mi entorno con losvolmenesoriginales de datos que la aplicacin utiliza en produccin. Lareestructuracindel modelo deBDque realizamos contempla un posterior escalado de la aplicacin que permitir la integracin continua con ms datos y nuevas tecnologas.</p>\n<p>La siguiente tabla muestra las principales fuentes de datos de las que se obtienen y enlaza la informacin. El volumen de datos que se puede llegar a manejar es grande, por cada parcela se persisten varios ndices vegetativos en cada uno de sus pxeles. </p>\n<table>\n<thead>\n<tr>\n<th align="left">FUENTE DATOS</th>\n<th align="left">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">QGIS</td>\n<td align="left">informacin geomomtrica de parcelas y sus pixles</td>\n</tr>\n<tr>\n<td align="left">ndices Vegetativos</td>\n<td align="left">provenientes de imgenes satelitales descargadas en diferentes fechas</td>\n</tr>\n<tr>\n<td align="left">Cultivos / Variedad</td>\n<td align="left">informacin tabulada en excels sobre tipo de cultivos y sus variedades</td>\n</tr>\n<tr>\n<td align="left">RF3</td>\n<td align="left">documentar el proceso de desarrollo generando los documentos de diseo pertinente</td>\n</tr>\n</tbody>\n</table>\n<p>Para poder realizar el trabajo utilizaremos una muestra representativa de los datos debido a que el proceso de descarga de ndices y persistencia de datos es largo para realizar las pruebas. El sistema est pensado para trabajar con muchas parcelas, en las pruebas que yo voy a realizar escogemos una muestra de 25 parcelas y pensaremos una descarga de ndices para no ms de 4 fechas diferentes.</p>\n<p>Es el histrico de ndices en diferentes fechas lo que permite al sistema realizar modelos predictivos. A mayor volumen de datos, ms precisin podremos obtener en los modelos posteriormente. El punto importante de este trabajo es la mejora del proceso y la automatizacin del flujo de datos, por ello no ser relevante que los modelos predictivos que creemos al final no tengan buena precisin. </p>\n<p>Para hacernos una idea, contemplando solo 25 parcelas, podemos almacenar 3000 pxeles. Por cada pixel vamos a registrar varios ndices vegetativos (ndvi, ndre) y para generar el histrico de datos esta informacin se multiplica por el nmero de fechas contempladas. Es decir, que aunque trabajamos sobre un volumen reducido para probar la automatizacin, siguen siendo mucha informacin que tiene que persistirse en la base de datos.</p>'</div><div id="automatizacion"><h3>3</h3>b'<p>El proceso que vamos a implantar requiere de un diseo que posibilite estructurar y manejar grandes volmenes de datos. Actualmente existen varias tecnologas que abordan el concepto de Pipeline desde un punto de vista global. No vamos a utilizar ninguna de estas tecnologas, ETL, nuestro proceso se se va ha desarrollar a medida, utilizando un Pipeline como una parte de la arquitectura, encargada de la transformacin de los datos hasta su almacenamiento en el modelo.</p>\n<p>Este proceso de diseo va a ser casi manual.</p>'</div><div id="tecnologías"><h3>3</h3>b'<p>El cdigo de la aplicacin que heredamos est escrito en Python. El lenguaje es una decisin adecuada debido a la necesidad de integrar tcnicas de procesamiento de datos e inteligencia artificial. El framework de Django para Python permite construir un proyecto robusto y despegarlo en un servidor con una interfaz web.</p>\n<p>Django nos ofrece las herramientas necesarias para trabajar desde un alto nivel de abstraccin y poder disear una aplicacin slida y estable. Algunas de estas herramientas son:</p>\n<ul>\n<li>ORM, Object-Relational-Mapping: permite crear un modelo de datos y gestiona automticamente la BD (base de datos), subyacente. Abstrae las consultas SQL y evita tener que realizar migraciones manuales de los esquemas.</li>\n<li>Static File Generator: podemos disear la interfaz de la aplicacin en formato web y desplegar en un servidor.</li>\n<li>Commands-System: gestin de comandos internos mediante los que se pueden automatizar tareas, utilizaremos esta arquitectura para disear el pipeline de datos y persistir la informacin proveniente de diferentes fuentes.</li>\n</ul>\n<p>Aunque el framework es muy potente, harn falta otras herramientas y entornos para completar con xito la automatizacin que buscamos y as conseguir un proceso de optimizacin continua. En el siguiente punto hablaremos de la infraestructura que la aplicacin requiere y de cmo podemos solventar algunos de los problemas de integracin ms importantes.</p>\n<p><img alt="caption" src="figures/django_migrate.png" title="original"/> </p>\n<p>La utilizacin de Python, aparte de incluir este framework, nos da la posibilidad de utilizar las libreras de inteligencia artificial y ciencia de datos que finalmente utilizaremos para la creacin del modelo de cultivo. Algunas de libreras principales que vamos a utilizar son las siguientes:</p>\n<table>\n<thead>\n<tr>\n<th align="left">LIBRERA</th>\n<th align="left">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">scikit-learn</td>\n<td align="left">creacin de modelos de inteligencia artificial</td>\n</tr>\n<tr>\n<td align="left">numpy</td>\n<td align="left">tratamiento de datos multidimensionales</td>\n</tr>\n<tr>\n<td align="left">pandas</td>\n<td align="left">uso de datos tabulados con herramientas para su procesamiento</td>\n</tr>\n</tbody>\n</table>'</div><div id="requisitos"><h3>3</h3>b'<p>La siguiente tabla muestra los requisitos funcionales crticos para completar con xito el proyecto, terminando el trabajo con un producto estable que el equipo pueda utilizar.</p>\n<table>\n<thead>\n<tr>\n<th align="left">REQUISITO</th>\n<th align="left">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">RF1</td>\n<td align="left">automatizar el despliegue de la aplicacin identificando las libreras y dependencias necesarias</td>\n</tr>\n<tr>\n<td align="left">RF2</td>\n<td align="left">redisear el modelo de datos para poder escalar la aplicacin y su gestin de datos.</td>\n</tr>\n<tr>\n<td align="left">RF3</td>\n<td align="left">documentar el proceso de desarrollo generando los documentos de diseo pertinentes.</td>\n</tr>\n<tr>\n<td align="left">RF4</td>\n<td align="left">creacin de un entorno comn que permita trabajar al equipo sobre las mismos fuentes de datos.</td>\n</tr>\n<tr>\n<td align="left">RF5</td>\n<td align="left">obtencin de una vista minable con la seleccin de features provenientes del modelo.</td>\n</tr>\n<tr>\n<td align="left">RF6</td>\n<td align="left">creacin de un modelo de produccin probando varios algoritmos de inteligencia artificial.</td>\n</tr>\n<tr>\n<td align="left">RF7</td>\n<td align="left">despliegue de los datos del modelo en la interfaz de la aplicacin.</td>\n</tr>\n</tbody>\n</table>\n<p>Como requisitos no funcionales para la aplicacin identificamos los siguientes, entendiendo que se completarn a lo largo de todo el proyecto.</p>\n<table>\n<thead>\n<tr>\n<th align="left">REQUISITO</th>\n<th align="left">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">RNF1</td>\n<td align="left">Crear un entorno Linux local con la misma configuracin necesaria en produccin.</td>\n</tr>\n<tr>\n<td align="left">RNF2</td>\n<td align="left">Preparar las fuentes de datos con una muestra pequea representativa de la aplicacin en produccin.</td>\n</tr>\n<tr>\n<td align="left">RNF3</td>\n<td align="left">Estudiar las posibles features para la vista minable que utilizar el modelo de produccin de cultivo</td>\n</tr>\n<tr>\n<td align="left">RNF4</td>\n<td align="left">Implantar un flujo de trabajo en el equipo para utilizar las mismas fuentes de datos</td>\n</tr>\n<tr>\n<td align="left">RNF5</td>\n<td align="left">Utilizar software libre</td>\n</tr>\n</tbody>\n</table>'</div><div id="0-infraestructura"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[infraestructure]]</p>\n<p>[[entorno]]</p>\n<p>[[UNIX]]</p>\n<p>[[control-versiones]]</p>'</div><div id="infraestructure"><h3>3</h3>b'<p>El entorno local sobre el cul desarrollamos y el de produccin donde se despliega la aplicacin son actualmente diferentes. Todos los miembros del equipo utilizamos mquinas Windows, mientras que el servidor de produccin es una mquina Ubuntu. Es un problema importante por el proceso de instalacin de las libreras necesarias para trabajar con los datos, se pierde gran cantidad de tiempo en preparar el entorno de cada persona que va ha trabajar con el repositorio de la aplicacin. Como solucin propondremos una nueva forma de trabajo que nos asegure un entorno comn con las mismas libreras y paquetes.</p>\n<div class="mermaid">\ngraph LR;\nsubgraph desarollo\nWSL--&gt; WSL.1\nWSL--&gt; WSL.2\nWSL--&gt; WSL.3\nend\n\nsubgraph produccin\n\nWSL.1--&gt; Ubuntu\nWSL.2--&gt; Ubuntu\nWSL.3--&gt; Ubuntu\n\nend\n\n\nBD_test--&gt;WSL\nBD_prod--&gt;Ubuntu\n\n\nsubgraph repositorio\nCODE --&gt; GIT\nGIT --&gt; WSL\nGIT --&gt; Ubuntu\nend\n</div>\n\n<p>Parte del trabajo consiste en la automatizacin del despliegue de la aplicacin. En este punto vemos como la infraestructura como cdigo permite aislar las libreras necesarias creando un script que deja una mquina en estado estable para ejecutar la aplicacin.</p>\n<p>Para poder utilizar tecnologas que posibiliten la integracin continua transformamos el entorno de desarrollo desplegando la aplicacin en UNIX. Identificamos las siguientes dependencias que necesitan ser instaladas:</p>\n<ul>\n<li>postgres 14 + postgis</li>\n<li>python3.10</li>\n<li>GDAL 3.3.2</li>\n<li>Django</li>\n<li>Virtual-Env [libreras ciencia de datos]</li>\n</ul>\n<p>Suele ser complicado encontrar todas las dependencias cons sus versiones correctas, en este caso el punto ms complicado ha sido la instalacin de Python con su versin correspondiente de GDAL, librera que permite tratar con los datos geoespaciales. Adems el sistema gestor de BD, \'postgres\' necesita una extensin especial, \'postgis\' para poder guardar los datos georeferenciados. Como este tipo de trabajo es casi de prueba y error, la utilidad del script que obtenemos es de gran valor.</p>\n<p>El primero de los entregables hace referencia a esta parte del proceso. El siguiente script automatiza la creacin de una mquina con las libreras necesarias, el cul una vez ejecutado, deja la aplicacin lista para su desligue.</p>\n<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>\n\ncurl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc<span class="p">|</span>sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg\n\nsudo sh -c <span class="s1">'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list'</span>\n\nsudo apt update\nsudo apt upgrade\n\nsudo apt install postgresql-14\nsudo apt install postgresql-14-postgis-scripts\n\nsudo service postgresql start\n\nsudo -u postgres createuser -P agrai_user\nsudo -u postgres createdb -O agrai_user agrai_db\nsudo -u postgres psql -c <span class="s2">"CREATE EXTENSION postgis; CREATE EXTENSION postgis_topology;"</span> agrai_db\n\n<span class="c1"># gdal native:</span>\nsudo add-apt-repository ppa:ubuntugis/ppa <span class="o">&amp;&amp;</span> sudo apt-get update\nsudo apt-get update\n\n<span class="c1"># cargarte la versin de la mquina, dejar solo 1:</span>\nsudo apt autoremove python3\n\n<span class="c1"># python repositories</span>\n\nsudo apt install software-properties-common -y\nsudo add-apt-repository ppa:deadsnakes/ppa\n\n<span class="c1"># python concrete installation</span>\n\nsudo apt install python3.10 <span class="c1"># version concreta</span>\nsudo apt-get install python3.10-dev python3.10-venv\nsudo apt install python3.10-dev python3.10-venv\nsudo apt install virtualenv\n\n<span class="c1"># python env var</span>\n\n<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">"/usr/local/bin/python3.10:/usr/local/lib/python3.10/lib-dynload:/usr/local/lib/python3.10/site-packages"</span>\n\n<span class="nb">alias</span> <span class="nv">py</span><span class="o">=</span>python3.10\n<span class="nb">alias</span> <span class="nv">python</span><span class="o">=</span>python3.10\n<span class="nb">alias</span> <span class="nv">python3</span><span class="o">=</span>python3.10\n\n<span class="c1"># creacion entorno_venv</span>\nsudo python3.10 -m venv ../agrai_venv\n\n<span class="c1"># GDAL</span>\nsudo apt-get install libgdal-dev\n\n<span class="c1"># env gdal lib variables</span>\n\n<span class="nb">export</span> <span class="nv">CPLUS_INCLUDE_PATH</span><span class="o">=</span>/usr/include/gdal\n<span class="nb">export</span> <span class="nv">C_INCLUDE_PATH</span><span class="o">=</span>/usr/include/gdal\n\n<span class="c1"># install dep in python agrai_venv</span>\n\n<span class="nb">source</span> ../agrai_venv/bin/activate\n<span class="c1"># pip install --upgrade pip # quitar</span>\nsudo python3 -m pip install -r requirements.txt\n</code></pre></div>\n\n<div class="codehilite"><pre><span></span><code><span class="n">psycopg2</span><span class="o">-</span><span class="n">binary</span>\n<span class="n">django</span>\n<span class="n">django</span><span class="o">-</span><span class="n">apscheduler</span>\n<span class="n">django_extensions</span>\n<span class="n">psycopg2</span>\n<span class="n">numpy</span>\n<span class="n">pandas</span>\n<span class="n">requests</span>\n<span class="n">pdfkit</span>\n<span class="n">fiona</span>\n<span class="n">rasterio</span>\n<span class="n">rasterstats</span>\n<span class="n">GDAL</span><span class="o">==</span><span class="mf">3.4.3</span>\n<span class="n">psycopg2</span><span class="o">-</span><span class="n">binary</span>\n<span class="n">xhtml2pdf</span>\n</code></pre></div>\n\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="entorno"><h3>3</h3>b'<p>Es importante preparar un entorno comn para el equipo. Django es un framework muy til por la integracin de las herramientas que hemos visto (ORM, web-interfaces, etc.), pero para conseguir un workflow adecuado necesitamos incluir otras herramientas propias de ciencia de datos como pueden ser cuadernos de jupyter y sus entornos con las libreras necesarias para ejecutar modelos predictivos.</p>\n<p>Migracin de todo el entorno a UNIX para posteriormente utilizar herramientas de integracin continua. El trabajo en el equipo local se hace a travs de una mquina en WSL (windows subsystem for Linux) para trabajar de forma semejante a un contender. Uno de los problemas principales para el equipo en su flujo de trabajo ha sido mantener una integridad entre el desarrollo realizad por los diferentes miembros del equipo y el posterior despliegue de la aplicacin en un entorno UNIX diferente al que se haba utilizado en local en las versiones de pre-produccin.</p>\n<p>Dedicamos varios das a preparar la integracin de Django con cuadernos jupyter y adems poder ejecutar diferentes entornos virtuales con las libreras adecuadas en cada momento. Los siguientes ejemplos muestran como se ha conseguido integrar las libreras necesarias para el despliegue de los cuadernos y su integracin con los datos y los modelos de Django.</p>\n<p>Los cuadernos jupyter que se encuentran en esta memoria se han exportado desde la propia aplicacin. Vemos la facilidad con la que el equipo puede redactar informes para clientes concretos.  Estos cuadernos son un punto tan importante de la arquitectura como puede ser el mdulo de servicios.</p>'</div><div id="UNIX"><h3>3</h3>b'<p>Hacemos uso de WSL (Windows Subsystem for Linux) para crear el entorno de desarrollo necesario para el proyecto. De esta forma conseguimos que los entornos de pruebas y produccin sean muy similares, permitiendo automatizar el despliegue de la aplicacin mediante tcnicas de infraestructura como cdigo. Una de las ventajas de tener una mquina Ubuntu como entorno de desarrollo es que mediante un script .sh instalamos todas las dependencias necesarias para dejar dicha mquina en un estado estable preparado para el despliegue de la aplicacin.</p>\n<p>Para el trabajo interno de la aplicacin necesitamos entornos con libreras ms pesadas como numpy o scikit-learn que no deberamos usar en la produccin de solo la interfaz web, ya que sta simplemente muestra los datos del parcelario registrado con su produccin estimada. Consideramos la posibilidad de crear varios entornos virtuales para los diferentes flujos de trabajo que contempla la aplicacin.</p>\n<ul>\n<li>Despliegue de la aplicacin</li>\n<li>data-science para la creacin de modelos a nivel interno.</li>\n</ul>\n<p>Actualmente solo existe un entono virtual sobre el cul se instalan todas las libreras python necesarias para el desarrollo y despliegue. Dicha refactorizacin sobre la infraestructura se contempla para prximos hitos en el proyecto. Es importante identificar aquellos puntos que sean propensos de un refactor grande, pero que no se lleven a cabo en el momento actual. Una vez identificados valoramos su importancia y vemos si el diseo actual impedira su mejora. En este caso sera muy sencillo, una vez crezca la aplicacin separar los entornos virtuales para mejorar el tiempo de build y deployment.</p>'</div><div id="control-versiones"><h3>3</h3>b'<p>Para poder desarrollar sobre software que est en produccin estamos utilizando un sistema de control de versiones bsico. Damos unas pequeas pinceladas sobre cmo evoluciona el software y las ramas que utilizamos. </p>\n<p>El cdigo de la aplicacin se encuentra en un nico servidor que gestiona su control de versiones a travs de SVN, Subversion. El siguiente diagrama muestra el flujo de desarrollo con las ramas creadas para el trabajo independiente sin romper el producto en produccin.</p>\n<div class="mermaid">\ngitGraph\ncommit\nbranch origins\ncommit tag:"v1.0.0"\ncommit\ncheckout main\ncommit type: HIGHLIGHT\ncommit\nmerge origins\ncommit\nbranch featureA\ncommit\n</div>\n\n<p>Al plantear un nuevo rediseo del producto, el trabajo tiene lugar en una rama diferente a la que se encuentra en produccin, Esta nueva rama, Origins, gestionar el rediseo del modelo de datos y la implementacin del proceso de automatizacin de los datos. Si el trabajo evoluciona correctamente, los futuros merges no deberan ser problemticos.</p>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="0-diseño"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[componentes]]</p>\n<p>[[data-load]]</p>\n<p>[[modelo-BD]]</p>\n<p>[[services]]</p>\n<p>[[despliegue]]</p>'</div><div id="componentes"><h3>3</h3>b'<p>introduccin para este apartado.</p>\n<p>Cuando comenc a trabajar con la aplicacin todo el cdigo se encontraba en un nico paquete con muy poca forma. A medida que se he ido refactorizando, se han creado entidades para modelar los datos y stas se han estructurado en componentes atmicas de la aplicacin.</p>\n<div class="mermaid">\nerDiagram\n\nCUADERNO ||--|{ CORE : uses\nROLES }|..|{ CORE : uses\nMETEO }|..|{ CORE : uses\nAUTO }|..|{ CORE : uses\n</div>\n\n<p>En Django podemos crear un proyecto compuesto por varias aplicaciones. En la documentacin oficial se explica como funciona la arquitectura del framework y se exponen ejemplos para que, una vez creadas, podamos acoplar y desacoplar las aplicaciones al proyecto. Es una forma similar de trabajo a cuando organizamos una librera en mltiples paquetes, pero un poco ms complicada debido a que el ORM subyacente traduce los modelos a tablas en una BD. Veamos cmo con solo aadir o quitar un string en nuestro settings activamos o desactivamos la aplicacin en el proyecto.</p>\n<div class="codehilite"><pre><span></span><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n\n  <span class="s1">'django_apscheduler'</span><span class="p">,</span>\n  <span class="s1">'django_extensions'</span><span class="p">,</span>\n\n  <span class="s1">'django.contrib.admin'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.auth'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.messages'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>\n  <span class="s1">'django.contrib.gis'</span><span class="p">,</span>\n\n  <span class="s1">'core'</span><span class="p">,</span>\n  <span class="s1">'meteo'</span><span class="p">,</span>\n  <span class="s1">'roles'</span><span class="p">,</span>\n  <span class="s1">'cuaderno'</span>\n  <span class="s1">'auto'</span>\n<span class="p">]</span>\n</code></pre></div>\n\n<p>Estas aplicaciones pueden comunicarse entre s a travs de sus modelos y servicios. En la siguiente tabla explicamos que hace cada sub-aplicacin.</p>\n<table>\n<thead>\n<tr>\n<th align="left">ENTIDAD</th>\n<th align="right">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Core</td>\n<td align="right">Como toda la informacin que se va a almacenar es referente a las parcelas y sus datos, toda la BD gira en torno a la tabla Parcela.</td>\n</tr>\n<tr>\n<td align="left">Roles</td>\n<td align="right">Separa los interesados que realizan acciones sobre el parcelario de las entidades principales</td>\n</tr>\n<tr>\n<td align="left">Meteo</td>\n<td align="right">Gestiona la comunicacin y descarga de datos de estaciones meteorolgicas</td>\n</tr>\n<tr>\n<td align="left">Cuaderno</td>\n<td align="right">Extiende el almacenamiento de datos relacionado con incidencias en el parcelario.</td>\n</tr>\n<tr>\n<td align="left">Auto</td>\n<td align="right">Contiene scripts y dependencias externas para la automatizacin de procesos, como la descarga de imgenes satelitles.</td>\n</tr>\n</tbody>\n</table>\n<p>Esta divisin en aplicaciones permite desarrollar y hacer pruebas solo con aquella parte del proyecto que necesitemos en el momento dado. Ms importante an la claridad y sencillez de los modelos de cada componente y su respectiva representacin en la BD.</p>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="data-load"><h3>3</h3>b'<p>Un modelo claro y robusto va a permitir cargar datos en la aplicacin de forma ordenada con posibilidad de ser escalados. En la implementacin del pipeline que veremos en siguientes apartados haremos hincapi en los estados de carga por los que pasan los datos, de momento solo importa destacar que el modelo actual permite mantener un histrico de datos mucho ms slido que el que estaba implantado cuando comenzamos el desarrollo. </p>\n<p>S que es importante explicar por qu vamos a poner tanto nfasis en que estos datos se gestionen de manera fluida y eficaz. La interfaz web de la aplicacin muestra la punta de un iceberg en la que el usuario observa las parcelas coloreadas basndose en los ndices vegetativos, tambin se muestra la produccin estimada.</p>\n<p><img alt="caption" src="figures/visor_GIS.png"/></p>\n<p>Los ndices que renderiza el visor de la aplicacin son el resultado de todo el proceso que estamos exponiendo. Es el punto ms delicado que requiere de varias entidades para persistir los datos y guardar un histrico. Es la visualizacin del histrico de ndices vegetativos el mayor valor que obtiene el cliente cuando accede a la aplicacin.</p>\n<p>El proceso de carga de datos hace uso de un mdulo de descarga de imgenes satelitales que obtiene el valor de estos ndices vegetativos. Este script de descarga ha sido desarrollado por el equipo y ha sido colocado dentro del mdulo de automatizacin junto con otras tareas similares. \nUtilizaremos el mdulo como una caja negra y aseguraremos el correcto uso de este para que los ndices vegetativos terminen en sus tablas correspondientes dentro de la BD.</p>\n<div class="mermaid">\nerDiagram\nAUTO }|..|{ descarga_indices : contains\nAUTO }|..|{ CORE : uses\n</div>\n\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="modelo-BD"><h3>3</h3>b'<p>Como inicio de la posterior automatizacin, se reestructura la arquitectura de la aplicacin junto con su BD para soportar el almacenamiento de nuevos datos. El siguiente esquema de BD es el resultado de la implementacin de la parte de anlisis descrita en el planteamiento.</p>\n<p><img alt="caption" src="figures/modelo-BD.png"/></p>\n<p>Para la creacin de este modelo he trabajado con el equipo en la identificacin de los conceptos que necesitaban ser representados. El diseo en papel da la posibilidad de pensar abiertamente sobre las relaciones entre entidades, adems de permitir la transmisin de ideas de forma sencilla durante las reuniones.</p>\n<p>Dentro del entorno de trabajo de <em>Django,</em> el ORM proporcionado asla la base de datos y nos permite disear directamente en <em>Python</em> dicho modelo. Las entidades se disean como clases y las relaciones entre ellas se especifican mediante el lenguaje de mapeo proporcionado, de dicha forma creamos las claves forneas que fsicamente contiene la base de datos.</p>\n<p>La utilizacin de este ORM es una ventaja que nos evita usar SQL directamente y permite poblar la base de datos mediante comandos <em>Python</em> desde la terminal. De todas formas, la localizacin fsica de la BD necesita ser enlazada correctamente. Este aislamiento posibilita utilizar diferentes bases de datos en los entornos locales y de produccin.</p>\n<p>Varias etapas han sido necesarias hasta llegar a un punto ms o menos estable. La herramienta <em>Graphviz</em> ha permitido obtener diagramas UML que visualizan la estructura de clases del modelo a partir del cdigo. Esta representacin grfica ha sido realmente til para poder pensar sobre el diseo a medida que avanzaba.</p>\n<h2>Entidades Principales</h2>\n<p>Del inicio anterior, nos quedamos solo con las entidades principales. Esta seleccin de entidades se realiza cuidadosamente para que la aplicacin pueda contemplar la mayor informacin posible haciendo uso de un esquema sencillo pero robusto. Analizamos el diseo detalladamente en los siguientes puntos.</p>\n<p><img alt="caption" src="figures/spectralgeo_db.png" title="original"/> </p>\n<p>Este rediseo contempla la mayora de casos posibles para el posterior tratamiento y procesamiento de datos, con posibilidad de crear buenos modelos predictivos. A continuacin se describen las entidades principales contempladas en la base de datos.</p>\n<table>\n<thead>\n<tr>\n<th align="left">ENTIDAD</th>\n<th align="right">DESCRIPCIN</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Parcela</td>\n<td align="right">Como toda la informacin que se va a almacenar es referente a las parcelas y sus datos, toda la BD gira en torno a la tabla Parcela.</td>\n</tr>\n<tr>\n<td align="left">Cultivo</td>\n<td align="right">Esta tabla est directamente unida a la anterior, ya que un cultivo puede tener muchas variedades diferentes se modela de forma recursiva con una clave fornea a s mismo (leer el siguiente punto, Ej: Guisante es un tipo de cultivo, pero tiene varias variedades: tirabeque, snap peas).</td>\n</tr>\n<tr>\n<td align="left">Indice</td>\n<td align="right">Esta taba es de vital importancia para el funcionamiento de la aplicacin, toda nuestra informacin lleva a estos datos vegetativos. Sern datos calculados en un dominio, esto se hace as ya que existen cientos de formas de denominar un mismo ndice de vegetacin y podra ser un desastre a la hora de realizar las consultas. Para ello se establecern algunos campos determinados en el campo tipo_indice y se les dar un valor en valor_indice.</td>\n</tr>\n<tr>\n<td align="left">Mirar_Indice</td>\n<td align="right">Contempla un histrico de datos y permite dar valor concreto a un ndice vegetativo en una fecha nica.</td>\n</tr>\n<tr>\n<td align="left">Fenolgico</td>\n<td align="right">Permite registrar diferentes estados fenolgicos por los que puede pasar un cultivo. La relacin entre el estado fenolgico y el cultivo se realiza a travs de la tabla Mirar_Fenologico.</td>\n</tr>\n<tr>\n<td align="left">Mirar_Fenologico</td>\n<td align="right">Permite dar carcter temporal al estado fenolgico de un cultivo. Registramos un estado para un cultivo en una fecha concreta.</td>\n</tr>\n<tr>\n<td align="left">Campaa</td>\n<td align="right">Es una tabla muy importante, sirve para unir distintos tipos de registros (desde variedades hasta labores de campo pasando por unir los datos de parcelas y subparcelas).</td>\n</tr>\n<tr>\n<td align="left">Interesado</td>\n<td align="right">Permite realizar el diseo de roles mediante su clave fornea a una parcela. Un intereseado (stakeholder) es una persona que tiene relacin con una o varias parcelas (Ej, cultivador, propietario, etc).</td>\n</tr>\n</tbody>\n</table>\n<p><img alt="caption" src="figures/modelo-end.png" title="original"/> </p>\n<h2>Diseo del Cultivo y Fenologa</h2>\n<p>Una decisin complicada sobre el posible histrico de datos es el registro de la evolucin de un cultivo en una parcela concreta. Mediante la tabla MIRAR_FENOLGICO damos carcter temporal al cultivo concreto que se est siendo cultivando en una parcela. De esta forma podemos registrar cules son los estados por los que ha pasado un cultivo, desde su "siembra" hasta su "recoleccin".</p>\n<p>El modelado de la entidad FENOLGICO ha sido una decisin complicada debido a que no se enlaza directamente con un cultivo. Entendemos que un estado como puede ser el de "siembra" tiene un carcter general y tiene sentido como entidad en s misma (todos los cultivos pasan por siembra). Es su relacin con CULTIVO mediante MIRAR_FENOLGICO lo que dice que dicho cultivo est en un estado fenolgico concreto en un momento determinado. Por ejemplo, podemos decir que el cultivo "vid" estaba en estado de "siembra" el da "2022-01-23". </p>\n<p>Tambin es importante destacar que CULTIVO es simplemente el tipo que se ha registrado, por lo tanto, para que la informacin sea completa un avistamiento fenolgico sucede sobre un tipo de cultivo fsicamente sembrado en una PARCELA.  El siguiente esquema muestra cmo estas tres entidades se relacionar para dar carcter temporal y espacial a un tipo de cultivo</p>\n<div class="mermaid">\nerDiagram\nCULTIVO ||--o{ CULTIVO : contains\nCULTIVO {\nstring nombre FK\nstring descripcion\nstring es_variedad FK\n}\nFENOLOGICO {\nstring nombre FK\nstring descripcion\n}\nMIRAR_FENOLOGICO ||--o{ FENOLOGICO : contains\nMIRAR_FENOLOGICO ||--o{ CULTIVO : contains\nMIRAR_FENOLOGICO ||--o{ PARCELA : contains\nMIRAR_FENOLOGICO {\nstring fenologico FK\nstring parcela FK\nstring fecha FK\n}\nPARCELA {\nstring idx\nstring estacion\nfloat altitud\npolygon geom\n}\n</div>\n\n<p>Otro punto importante de la aplicacin es la contemplacin de variedades. Para poder mantener una jerarqua con las posibles entidades registradas en el sistema, enlazamos de forma recursiva el cultivo con una clave fornea a su misma tabla. Esta estructura permite el desglose de una jerarqua de cultivos en la que sabemos qu entidad es una subvariedad de un cultivo, dando la posibilidad de almacenar mltiples niveles.</p>\n<p><img alt="caption" src="figures/mirar_feno.png" title="original"/> </p>\n<h2>Diseo de ndices Vegetativos</h2>\n<p>Para nuestro sistema de informacin una parcela es una agrupacin de varios pxeles. Entendemos como PIXEL a la imagen satelital ms pequea que se puede obtener sobre el terreno, a partir de la cual obtendremos los ndices vegetativos.</p>\n<p>El trabajo con ndices vegetativos por parte del equipo es uno de los puntos ms importantes para que el rediseo sea satisfactorio. A continuacin mostramos cmo las relaciones identificadas van a permitir una correcta bsqueda de features para despus poder estimar con precisin en el modelo de produccin de cultivo.</p>\n<div class="mermaid">\nerDiagram\nINDICE ||--o{ MIRAR_INDICE : contains\nINDICE {\nstring nombre FK\nstring descripcion\n}\nPIXEL ||--o{ MIRAR_INDICE : contains\nPIXEL ||--o{ PARCELA : contains\nPIXEL {\nstring parcela FK\npolygon geom\nstring idx\n}\nPARCELA {\nstring idx\nstring estacion\nfloat altitud\npolygon geom\n}\nMIRAR_INDICE {\nstring indice FK\nstring pixel FK\ndate fecha\ngeojson json\nfloat valor\n}\n</div>\n\n<p>Este diseo de ndices permite mantener un histrico de datos preciso. </p>\n<h2>Diseo de Roles</h2>\n<p>Aunque es un punto secundario, la aplicacin contempla que diferentes usuarios puedan realizar diferentes acciones. Recordamos que habamos separado diferentes componentes de la aplicacin, los roles se encuentran en un mdulo secundario independiente de las entidades anteriores que representaban los conceptos agronmicos y vegetativos. El diseo modular del modelo de datos permite al equipo aadir diferentes roles sin estos estar "hardcoded" en el cdigo de la aplicacin. La siguiente tabla muestra los roles hasta ahora creados por el equipo y su relacin con el parcelario.</p>\n<table>\n<thead>\n<tr>\n<th align="left">ROL</th>\n<th align="right">DESC</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">Agricultor</td>\n<td align="right">usuario de las parcelas</td>\n</tr>\n<tr>\n<td align="left">Cooperativa</td>\n<td align="right">entidad que agrupa a tcnos con diferentes cargos sobre un parcelario</td>\n</tr>\n<tr>\n<td align="left">Tecnico</td>\n<td align="right">personal asignado a un nmero de parcelas.</td>\n</tr>\n</tbody>\n</table>\n<p>Roles necesarios para la organizacin jerrquica necesaria en una organizacin agraria. Estos roles permiten agrupara diferentes funciones que encontramos en el software diseadas como diferentes servicios.</p>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="services"><h3>3</h3>b'<p>El trmino servicio est sobrecargado y su significado adquiere diferentes matices segn el contexto en que estemos. Como resultado, existe una nube de confusin en torno a la nocin de servicios cuando se trata de distinguir entre servicios de aplicacin, servicios de dominio, servicios de infraestructura, servicios SOA, etc. Las funciones de estos son diferentes y pueden abarcar todas las capas de una aplicacin.</p>\n<p>De hecho, un servicio es un ttulo un tanto genrico para un bloque de creacin de una aplicacin porque implica muy poco. En primer lugar, un servicio implica un cliente cuyas solicitudes est diseado para satisfacer. Otra caracterstica de una operacin de servicio es la de entrada y salida: se proporcionan argumentos y como entrada a una operacin y se devuelve un resultado. Ms all de esta implicacin suelen estar los supuestos de "statelessness" y la idea de "pure fabrication" segn GRASP.</p>\n<div class="codehilite"><pre><span></span><code>When a significant process or transformation in the domain is not a natural responsibility of an ENTITY or VALUE OBJECT, add an operation to the model as standalone interface declared as a SERVICE. Define the interface in terms of the language of the model and make sure the operation name is part of the UBIQUITOUS LANGUAGE. Make the SERVICE stateless.\n\n**Eric Evans** Domain-Driven Design \n</code></pre></div>\n\n<p>El tipo de servicios que estamos diseando e implementando para nuestra aplicacin forman parte de la capa de dominio. Estos servicios de dominio a menudo se pasan por alto como bloques deconstruccin clave, confundidos por el enfoque de las entidades del modelo (o value objects).</p>\n<p>Cumpliendo con los principios mencionados, los servicios conforman la siguiente capa de abstraccin al modelo de datos implementado. Colocaremos aquellas operaciones que dependan o relacionen ms de una entidad en su mdulo correspondiente de servicios y no como un mtodo de la clase del modelo. Este tipo de diseo en el que dejamos el modelo casi sin mtodos propios puede llegar a entenderse como un anti-patrn, <a href="http://martinfowler.com/bliki/AnemicDomainModel.html">anemic domain model</a></p>\n<p>Justificamos la implementacin de la gran parte de los mtodos sobre la capa de servicios por el tipo de informacin histrica sobre la que necesitamos hacer las consultas. La mayora de entidades necesitan de una relacin con otra segunda o tercera entidad para devolver la informacin pertinente. Es quizs que el modelo est orientado a manejar informacin histrica y sin estado, lo que nos lleva a colocar casi todos los mtodos de acceso a los datos en un mdulo de servicios aparte. Miremos el siguiente ejemplo sobre los histricos fenolgicos en el parcelario registrado.</p>\n<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ParcelaCultivos_Service</span><span class="p">():</span>\n\n  <span class="k">def</span> <span class="nf">get_cultivo</span><span class="p">(</span><span class="n">parcela_p</span><span class="p">):</span>\n\n    <span class="sd">""" ltimo cultivo que se est cultivando en una parcela """</span>\n\n    <span class="n">mirar_feno</span> <span class="o">=</span> <span class="n">Mirar_Fenologico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parcela</span> <span class="o">=</span> <span class="n">parcela_p</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>\n\n    <span class="k">if</span> <span class="p">(</span><span class="n">mirar_feno</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>\n\n      <span class="k">return</span> <span class="n">mirar_feno</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">'fecha'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cultivo</span>\n\n    <span class="k">else</span><span class="p">:</span>\n\n      <span class="k">return</span> <span class="kc">None</span>\n\n  <span class="k">def</span> <span class="nf">get_historico_fenologicos</span><span class="p">(</span><span class="n">parcela_p</span><span class="p">):</span>\n\n    <span class="sd">""" todos los estados fenolgicos por los que ha pasado una parcela """</span>\n\n    <span class="k">return</span> <span class="n">Mirar_Fenologico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parcela</span> <span class="o">=</span> <span class="n">parcela_p</span><span class="o">.</span><span class="n">referencia</span><span class="p">)</span>\n\n  <span class="k">def</span> <span class="nf">get_historico_range</span><span class="p">(</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_end</span><span class="p">):</span>\n\n    <span class="sd">""" histrico de todas las parcelas en un rango de fechas """</span>\n\n    <span class="k">return</span> <span class="n">Mirar_Fenologico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fecha__range</span><span class="o">=</span><span class="p">[</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_end</span><span class="p">])</span>\n\n  <span class="k">def</span> <span class="nf">get_historico_parcela</span><span class="p">(</span><span class="n">parcela1</span><span class="p">):</span>\n\n    <span class="sd">""" todo el histrico de una parcela """</span>\n\n    <span class="k">return</span> <span class="n">Mirar_Fenologico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parcela</span> <span class="o">=</span> <span class="n">parcela1</span><span class="p">)</span>\n\n  <span class="k">def</span> <span class="nf">get_historico_parcela_range</span><span class="p">(</span><span class="n">parcela1</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_end</span><span class="p">):</span>\n\n    <span class="sd">""" hostrico de una parcela en un rango de fechas """</span>\n\n    <span class="n">historico</span> <span class="o">=</span> <span class="n">ParcelaCultivos_Service</span><span class="o">.</span><span class="n">get_historico_range</span><span class="p">(</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_end</span><span class="p">)</span>\n\n    <span class="k">return</span> <span class="n">historico</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parcela</span> <span class="o">=</span> <span class="n">parcela1</span><span class="p">)</span>\n\n  <span class="k">def</span> <span class="nf">get_historico_mismo_fenologico</span><span class="p">(</span><span class="n">valor_fenologico</span><span class="p">):</span>\n\n    <span class="sd">""" todo los cultivos que estn en un mismo estado fenolgico """</span>\n\n    <span class="k">return</span> <span class="n">Mirar_Fenologico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">estado</span> <span class="o">=</span> <span class="n">valor_fenologico</span><span class="p">)</span>\n</code></pre></div>\n\n<p><a href="file:///E:/UR/TFG/txt_mem/_k.pcs.zen/publish/index.html">Adjuntamos</a> como entregables del proyecto algunos de los servicios diseados y usados ms frecuentemente. El cdigo</p>\n<ul>\n<li>pequeo parrafo.</li>\n</ul>\n<p>El pipeline que estamos diseando es posible gracias a la factorizacin en mdulos de la aplicacin y a la sencillez y versatilidad del modelo. Los servicios que ahora diseamos abstraen al resto del equipo de la funcionalidad subyacente y me permiten crear diferentes interfaces con propsitos distintos. Son muy importantes, ya que nos acercan al flujo de trabajo de integracin continua que estamos buscando.</p>\n<p>Como estamos utilizando el ORM de Django, para no sobrecargar los objetos del modelo con demasiados mtodos establecemos un mdulo de servicios (para cada componte del sistema) con las consultas ms frecuentes. Este mdulo ayuda a mantener el cdigo en el modelo limpio sin complejidad aadida debido a que las consultas / mtodos que hacen uso de varias relaciones quedan como entidades separadas que se pueden reutilizar.</p>\n<p>La siguiente funcin es una de las ms usadas debido a la integracin directa con el proceso de descarga de imgenes satelitales del cultivo.</p>'</div><div id="despliegue"><h3>3</h3>b'<p>Con la aplicacin en un estado slido, procedemos a mostrar los datos en la interfaz web. Aunque no es parte del trabajo establecido para este TFG, necesitamos ver que los datos con los que trabajamos se muestran correctamente en el visor GIS de nuestra interfaz. </p>\n<p>Recordemos que dentro de nuestras fuentes de datos tenemos datos de parcelas con su informacin geoespacial, tanto la forma de la parcela como la de todos sus pxeles que la conforman. Como estamos haciendo pruebas con un nmero reducido de datos, 25 parcelas con sus pxeles e ndices asociados, el visor debe mostrar estas 25 parcelas con diferentes colores dependiendo del valor de los indices estudiados.</p>\n<ul>\n<li>captura visor *</li>\n</ul>'</div><div id="0-implementacion"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[previos-pipe]]</p>\n<p>[[commands-CLI]]</p>\n<p>[[model-view]]</p>\n<p>[[modelo-produccin]]</p>'</div><div id="previos-pipe"><h3>3</h3>b"<p>Es importante diferenciar qu tipo de estructura estamos construyendo. Existen actualmente varias arquitecturas para 'pipelines' como pueden ser ETLs u otras. Para la correcta carga y transformacin de datos no utilizaremos ninguna de estas arquitecturas, sino que disearemos los bloques necesarios en cada paso para poblar nuestra base de datos. Este proceso puede entenderse como una canalizacin de datos, en la que recibimos informacin en diferentes fuentes y la dotamos de contexto dentro de la BD.</p>\n<h2>Qu es una canalizacin de datos?</h2>\n<p>Una canalizacin de datos se refiere a los pasos necesarios para mover datos del sistema de origen al sistema de destino. Estos pasos incluyen copiar datos, transferirlos desde una ubicacin en el sitio a la nube y combinarlos con otras fuentes de datos. El objetivo principal de una canalizacin de datos es garantizar que todos estos pasos se produzcan de forma coherente con todos los datos.</p>\n<p>En el apartado anterior hemos visto cmo se ha diseado el modelo de datos. Ahora nos centramos en los pequeos pasos de carga que vamos a dar para que los datos agronmicos de clientes e imgenes satelitales se persistan en dicho modelo. Valoramos la identificacin de unidades atmicas de informacin que puedan persistirse reiteradamente. Es decir, buscaremos acotar pequeos procesos de carga que puedan ejecutarse en varios puntos dependiendo del volumen de datos de clientes que maneje el equipo en un momento dado.</p>\n<h2>Procesos de una canalizacin</h2>\n<p>Identificamos tres conceptos que definen la canalizacin de datos que vamos a llevar a cabo y exponemos que hace el 'pipeline' de nuestra aplicacin en cada uno de ellos.  </p>\n<ul>\n<li>\n<p>Data Ingestion: diseamos bloques atmicos de carga que persisten datos de fuentes diferentes en la base de datos de la aplicacin.</p>\n</li>\n<li>\n<p>Data Transformation: utilizamos los bloques de carga para persistir los datos en nuestro modelo de Django.</p>\n</li>\n<li>\n<p>Data Storage: almacenamos los datos en el modelo a travs de Django y manteniendo una base de datos relacional en la mquina en la que se encuentra la aplicacin.</p>\n</li>\n</ul>\n<p>Como hemos dicho, hay varias formas de realizar este proceso de canalizacin, en el siguiente punto exponemos la tecnologa subyacente que utilizaremos para ello. </p>"</div><div id="commands-CLI"><h3>3</h3>b'<p>En ingeniera de software, un <strong>patrn de diseo</strong> es una solucin general y reutilizable para un problema comn dentro de un contexto dado. El trmino pipeline puede hacer referencia a diferentes soluciones y contextos. De momento vamos a centrarnos en su aplicacin como patrn de diseo ya que en nuestra aplicacin se est utilizando como tal.</p>\n<p>**Podemos definir un pipeline como una cadena de elementos de procesamiento (procesos, subprocesos, rutinas, funciones, etc.), dispuestos de modo que la salida de cada elemento sea la entrada del siguiente; el nombre hace referencia al flujo de una o varias tuberas.</p>\n<p>En nuestro caso vamos a utilizar la arquitectura de comandos que proporciona Django para disear los procesos de transformacin de datos que van a poblar la base de datos. La definicin y reutilizacin del proceso de poblacin es muy importante debido a la forma de trabajo que tiene la empresa con diferentes clientes. Dependiendo de la magnitud del cliente se prepara una copia de la aplicacin para trabajar con sus datos, por ello una vez definido las unidades atmicas del proceso de carga de datos, se podrn disear diferentes pipelines para cada cliente. Para este trabajo nos conformaremos con el diseo y la implementacin de un proceso general, pero manteniendo la idea de que pueda ser escalado ms adelante.</p>\n<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.core.management.base</span> <span class="kn">import</span> <span class="n">BaseCommand</span>\n\n<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>\n\n    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>\n\n        <span class="c1"># now do the things that you want with your models here</span>\n</code></pre></div>\n\n<p>Las lneas de cdigo anteriores hacen referencia a una implementacin concreta del patrn mencionado.  Fijndonos en la siguiente figura, la clase <strong>Command</strong> sera el handler y el mtodo <strong>handle</strong> corresponde con handleRequest del esquema. Los prximos scripts que creemos sern los clientes de estas clases. Resaltar que la implementacin de Django de este patrn es un poco ms compleja porque los comandos que encapsulan la funcionalidad permiten tomar diferentes parmetros. </p>\n<p><img alt="caption" src="figures/pipeline_pattern.png"/></p>\n<p>Con este patrn desarrollamos la infraestructura necesaria para cargar los datos en el modelo. Cada comando representa un proceso de carga de datos, el cual se puede componer posteriormente dentro de un proceso ms complejo. Cada unidad de carga se comporta como un filtro que aade de forma ordenada la informacin al modelo de datos, enlazando las entidades con sus datos correspondientes. Utilizaremos estas unidades para generar diferentes tuberas que permitan dejar varias instancias de la aplicacin en estados diferentes.</p>\n<p>Para AGRAI, hacen falta transformar los datos de ndices vegetativos que maneja el equipo en informacin ordenada que llegue al modelo de datos desarrollado anteriormente. A continuacin explicamos el flujo de procesos de carga ms utilizado.</p>\n<p>Los datos principalmente provienen de qgis, software para trabajar con informacin georeferenciada. El equipo pre-procesa la informacin sobre los ndices vegetativos y da valores a los pxeles mediante dicho software. La principal funcin de este trabajo es dar sentido a esa informacin, persistiendo los datos tomados junto con sus relaciones con el parcelario fsico.</p>\n<div class="mermaid">\ngraph LR;\nqgis--&gt;parcelas;\nparcelas--&gt;cultivos;\ncultivos--&gt;ndices;\nndices--&gt;vista_minable;\nvista_minable--&gt;modelo;\n</div>\n\n<p>La informacin de los pxeles tiene que enlazarse con los datos de parcelas y cultivos. Cuando obtenemos los ndices vegetativos solo contemplamos la informacin sobre la geometra de la parcela, no sabemos nada ms. Esta informacin tiene que almacenarse junto con el cultivo, estado fenolgico, datos fsicos de la parcela, etc. En la siguiente tabla explicamos cada uno de los scripts que conforman los procesos del pipeline.</p>\n<table>\n<thead>\n<tr>\n<th align="left">SCRIPT</th>\n<th align="right">TAREA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">load_qgis</td>\n<td align="right">Extrae la informacin geometica de cada pixel proveniente de "qgis" e inserta dicha informacin en las tablas de "parcela" y "pixel" de la BD.</td>\n</tr>\n<tr>\n<td align="left">load_parcela</td>\n<td align="right">Lee de un excel informacin fisca sobre las parcelas e inserta los datos en la BD.</td>\n</tr>\n<tr>\n<td align="left">load_cultivos</td>\n<td align="right">Lee de un excel informacin sobre cultivos con sus variedades e inserta los datos en la BD.</td>\n</tr>\n<tr>\n<td align="left">download_img</td>\n<td align="right">Usa uno de los mdulos desarrollado por el equipo para descargar ndices vegetativos a partir de imgenes satelitales. No persiste nada directamente, devuelve un dataframe con los datos descargagos.</td>\n</tr>\n<tr>\n<td align="left">load_indice</td>\n<td align="right">integra la informacin de ndices descargada en el paso anterior en la tabla de "pixel" de la BD.</td>\n</tr>\n</tbody>\n</table>\n<p>Para entender detalladamente qu hacen los scripts de carga de ndices tenemos que explicar algunos de los procesos de automatizacin de los que hacemos uso. </p>\n<div class="mermaid">\ngraph LR;\nindices --&gt; download_indices;\ndownload_indices --&gt; download_today\ndownload_indices --&gt; download_range\n</div>\n\n<p>Estos scripts nos permiten crear el flujo necesario para que la aplicacin procese la informacin y termine en un estado consistente. Parte del proceso necesita ser automatizado y ejecutado reiteradamente, aadiendo los datos a la BD y relacionndolos adecuadamente. En nuestro contexto agronmico, es la descarga de ndices la parte del proceso que necesita ser automatizada, mientras que los datos de las parcelas y cultivos y la informacin geoespacial se pueden cargar directamente en el despliegue de la aplicacin. </p>\n<p>Con esta estructura de tuberas lista, podemos reutilizar cualquier parte del proceso. Un planificador de tareas nos ayuda a establecer el tiempo que tiene que transcurrir entre las descargas. Sin entrar en ms detalle, se ha utilizado el scheduler por defecto del framework de Django que estamos utilizando para esta gestin de tiempos y descarga.</p>\n<p>Finalmente, para realizar pruebas, queremos crear un nico script que ejecute el proceso de forma ordenada. El resto de tuberas que se adjuntan en el proyecto tienen una forma similar y hacen el mismo uso de los comandos de Django que hemos explicado.</p>\n<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">LoggingBaseCommand</span><span class="p">):</span>\n\n  <span class="n">help</span> <span class="o">=</span> <span class="s1">'Carga la geometra a las parcelas y a los pixeles'</span>\n\n  <span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>\n  <span class="n">PARCELA_SHAPE</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'data'</span> <span class="o">/</span> <span class="s1">'parcelas'</span> <span class="o">/</span> <span class="s1">'25'</span> <span class="o">/</span> <span class="s1">'parcelas.shp'</span>\n  <span class="n">PIXEL_SHAPE</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'data'</span> <span class="o">/</span> <span class="s1">'parcelas'</span> <span class="o">/</span> <span class="s1">'25'</span> <span class="o">/</span> <span class="s1">'pixeles.shp'</span>\n  <span class="n">FICHERO_PATH</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'data'</span> <span class="o">/</span> <span class="s1">'excels'</span> <span class="o">/</span> <span class="s1">'datos-test-2.xls'</span>\n  <span class="n">TRILINEA_PATH</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'data'</span> <span class="o">/</span> <span class="s1">'trilineas'</span> <span class="o">/</span> <span class="s1">'PRilineas.json'</span>\n\n  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>\n\n    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>\n\n  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n\n    <span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARCELA_SHAPE</span><span class="p">))</span>\n\n    <span class="n">call_command</span><span class="p">(</span><span class="s1">'1-load-qgis'</span><span class="p">,</span><span class="n">parcelas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PARCELA_SHAPE</span><span class="p">,</span> <span class="n">pixels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PIXEL_SHAPE</span><span class="p">)</span>\n\n    <span class="n">call_command</span><span class="p">(</span><span class="s1">'2-load-parcela-data'</span><span class="p">,</span> <span class="n">excel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FICHERO_PATH</span><span class="p">))</span>\n\n    <span class="n">call_command</span><span class="p">(</span><span class="s1">'3-load-cultivos'</span><span class="p">,</span> <span class="n">excel</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FICHERO_PATH</span><span class="p">))</span>\n\n    <span class="n">call_command</span><span class="p">(</span><span class="s1">'4-download-indices'</span><span class="p">,</span><span class="n">parcelas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PARCELA_SHAPE</span><span class="p">,</span> <span class="n">pixels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PIXEL_SHAPE</span><span class="p">)</span>\n</code></pre></div>\n\n<p>Adems de este ltimo, podemos crear varios entornos con tuberas diferentes que den como resultado bases de datos con estados distintos. Como mencionbamos anteriormente, es muy til debido al funcionamiento del equipo en relacin con el procesamiento de datos con varios clientes. La aplicacin puede trabajar con instancias diferentes de la misma base de datos dependiendo del proyecto en el que se encuentre, por ejemplo la misma instancia de la BD sirve tanto para una bodega con variedades de vino que para una cooperativa que contempla varios cultivos como guisantes, olivas, peras, etc.</p>\n<p>Por ltimo, este patrn nos permite ejecutar comandos de forma asncrona y gestionar los procesos con un planificador. Actualmente, aunque el tiempo de carga es alto, podemos asumir una carga lenta. Pero es este mismo patrn de diseo el que nos puede permitir a futuro la carga asncrona de los datos en cada una de las componentes que lo forman.</p>\n<p>Adjuntamos en los entregables los [scripts] que forman este proceso de persistencia de datos. </p>\n<h1>Pipeline Pattern</h1>\n<p>https://medium.com/@bonnotguillaume/software-architecture-the-pipeline-design-pattern-from-zero-to-hero-b5c43d8a4e60</p>\n<p>Vamos a ver el patrn de diseo de Pipeline como entidad nica.</p>\n<ul>\n<li>relacin con programacin funcional.</li>\n<li>uso de diagramas y todo el rollo.</li>\n</ul>\n<p>algn patron de diseo relacionado con un pipeline.</p>\n<h1>explicacin del patrn y posible post -&gt;</h1>\n<p>patron en Django con comandos</p>\n<script>mermaid.initialize({startOnLoad:true});</script>'</div><div id="model-view"><h3>3</h3>b'<p>Hasta este punto habamos insertado en la base da datos la informacin que provena de diferentes fuentes. Hemos dotado de consistencia y relacin a los datos y se ha creado un sistema con capacidad para hacer consultas sobre estos de forma ordenada y sencilla.</p>\n<p>Ahora, fuera de la estructura de comandos de Django y utilizando el entorno virtual creado y los cuadernos integrados en la aplicacin, escribimos el algoritmo para extraer los datos y dar la forma necesaria para los siguientes pasos.</p>\n<p>El cdigo que mostramos en este apartado corresponde con la generacin de la vista tabulada con la que vamos a crear el modelo de produccin de cultivo. Ahora realizamos el proceso inverso a la persistencia de datos que hemos realizado hasta este punto. Utilizamos la informacin y sus relaciones persistidas en la base de datos de nuestro sistema para generar la vista minable que necesita el modelo predictivo. </p>\n<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">core.models</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>\n\n<span class="c1"># indices:</span>\n<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ndvi'</span><span class="p">,</span> <span class="s1">'ndre'</span><span class="p">]</span>\n\n<span class="k">def</span> <span class="nf">statistic_indices</span><span class="p">(</span><span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ndvi'</span><span class="p">,</span> <span class="s1">'ndre'</span><span class="p">],</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>\n\n  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>\n  <span class="c1"># para cada indice:</span>\n\n  <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>\n\n    <span class="n">indice_p</span> <span class="o">=</span> <span class="n">Indice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nombre</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>\n\n    <span class="k">for</span> <span class="n">fecha</span> <span class="ow">in</span> <span class="n">fechas</span><span class="p">:</span>\n\n      <span class="n">col_data</span> <span class="o">=</span> <span class="p">[]</span>\n\n      <span class="c1"># por cada iteracin de hay una fila en el df:</span>\n\n      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Parcela</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>\n\n        <span class="c1"># la media de todos sus pixels de cada parcela por cada ndice</span>\n\n        <span class="n">p_indices</span> <span class="o">=</span> <span class="n">Pixel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parcela</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>\n        <span class="n">list_values</span> <span class="o">=</span> <span class="p">[]</span>\n\n        <span class="k">for</span> <span class="n">p_itr</span> <span class="ow">in</span> <span class="n">p_indices</span><span class="p">:</span>\n\n          <span class="n">qs</span> <span class="o">=</span> <span class="n">Mirar_Indice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>\n\n            <span class="n">pixel</span> <span class="o">=</span> <span class="n">p_itr</span><span class="p">,</span>\n            <span class="n">indice</span> <span class="o">=</span> <span class="n">indice_p</span><span class="p">,</span>\n            <span class="n">fecha</span> <span class="o">=</span> <span class="n">fecha</span> <span class="c1"># fecha para la columna:</span>\n          <span class="p">)</span>\n\n          <span class="kn">import</span> <span class="nn">math</span>\n\n          <span class="c1"># mirarmos que no sea nulo, porque se puede dar el caso</span>\n          <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">valor</span><span class="p">)</span> <span class="p">):</span>\n\n            <span class="n">list_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">valor</span><span class="p">)</span>\n\n        <span class="c1"># estadistico</span>\n\n        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">list_values</span><span class="p">)</span>\n        <span class="n">col_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>\n\n      <span class="n">df</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">ind</span> <span class="o">+</span><span class="s1">'_'</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fecha</span><span class="p">)]</span> <span class="o">=</span> <span class="n">col_data</span>\n\n  <span class="k">return</span> <span class="n">df</span>\n</code></pre></div>\n\n<h2>Seleccin de features</h2>\n<p>El diseo de la vista minable es complicado, para ello trabajo con el equipo seleccionando los campos de la BD ms importantes que formaran la tabla.  Nos centramos principalmente en los ndices vegetativos registrados en diferentes fechas. </p>\n<p>Para poder predecir la produccin de cultivo incluimos en la vista varios estadsticos como la media y el sumatorio para cada ndice en cuatro fechas representativas de la evolucin de este. El diseo de esta estructura proviene de un estudio previo realizado por el equipo, en el que se ha concluido que ciertos estadsticos en unas fechas calibradas funcionan bien para predecir la produccin. </p>\n<p>Hablbamos anteriormente de entornos virtuales, por el momento la aplicacin utiliza un solo entorno virtual Python, pero este punto del trabajo podra hacer uso de un entorno separado con las libreras de ciencia de datos instaladas, de tal forma separaramos dos procesos importantes. Resaltar que en el trabajo me estoy encargando del proceso para hacer pruebas, pero sern diferentes miembros del equipo los que usen estas tecnologas y para que podamos seguir escalando a medida que evolucione la aplicacin, estos miembros tienen que poder utilizar los entornos creados.</p>\n<h2>Variable Objetivo</h2>\n<p>Junto con los datos extrados aadimos la variable objetivo de produccin. Esta variable, todava sin persistir en el modelo, hace referencia a los kilos de produccin de cada parcela en su cosecha.</p>'</div><div id="modelo-producción"><h3>3</h3>b'<p>La vista minable que hemos obtenido representa los datos necesarios para crear un modelo de produccin para el cultivo. El <a href="https://github.com/alesteba/tfg/tree/main/entregables">prximo entregable</a> es el desarrollo de uno o varios cuadernos de jupyter con modelos de inteligencia artificial para la tabla anterior.</p>\n<p>-- explicacin posibles vistas minables y arquitectura --</p>\n<p>En el punto en el que estamos podemos pensar en las mltiples vistas que se pueden generar a partir de los datos persistidos en el BD. Desde aqu desarrollaremos la automatizacin de la bsqueda del mejor modelo posible para la vista anterior, pero siempre teniendo en cuenta que a partir de los datos persistidos podemos predecir muchos otros valores, no solo la produccin de un cultivo.</p>\n<p>Como los datos con los que trabajamos en los cuadernos provienen de una base de datos estructurada y previamente estudiada, no va a hacer falta un paso de preprocesamiento previo. \nS que intentaremos que los datos de produccin con los que vamos a predecir estn normalizados y se haya hecho una bsqueda previa de outliers.</p>\n<p>Buscamos un modelo de regresin para el nmero de Kg de cultivo en cada parcela. Aunque los datos son representativos de un parcelario pequeo, disearemos los cuadernos para automatizar la bsqueda del mejor modelo con cualquier volumen de datos que podamos necesitar ms adelante.</p>\n<p>El rango de valores para la mayora de los ndices que obtenemos va de -1 a 1. Los datos de ndices negativos que llegan a la vista se pueden considerar como outliers. Esto es debido a que si los ndices provienen de una imagen con nubes, no se diferencian los colores del terreno y el ndice acaba teniendo un valor muy malo. Para evitar valores corruptos eliminaremos los ndices que provengan de la toma de la imagen en una fecha en la que haba nubes.</p>\n<p><img alt="caption" src="figures/nubes.png"/></p>\n<p>El <a href="https://github.com/alesteba/tfg/tree/main/entregables">siguiente repositorio</a> contiene los cuadernos necesarios para la gestin y automatizacin de los modelos de produccin generados a partir los datos de las 25 parcelas estudiadas.</p>'</div><div id="0-seguimiento"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[seguimiento]]</p>\n<p>[[memoria]]</p>\n<p>[[lecciones]]</p>'</div><div id="seguimiento"><h3>3</h3>b'<p>A pesar de realizar la planificacin del proyecto, el desarrollo ha diferido de la misma en<br/>\nalgunas ocasiones. Esta seccin est dedicada a uno de los puntos ms importantes en el<br/>\ndesarrollo de proyectos: el seguimiento y control.  </p>\n<p>El nmero de horas planificadas era de 300, las cuales se repartan en 7 etapas marcadas<br/>\npor los diversos puntos de control: Planificacin, anlisis, diseo, implementacin,<br/>\npruebas, memoria y seguimiento del trabajo.  </p>\n<p>A continuacin, podremos ver en la tabla 4 las horas estimadas respecto a las reales junto<br/>\ncon las horas de desviacin de cada uno de los paquetes de trabajo.</p>'</div><div id="memoria"><h3>3</h3>b'<p>cmo se ha escrito y por qu.</p>'</div><div id="lecciones"><h3>3</h3>b'<p>El objetivo de este trabajo no es obtener un producto software final sino la optimizacin de un proceso o flujo de trabajo. Los cambios planteados mejoran el acceso a los datos y la forma de procesar estos por el resto de participantes del equipo. </p>\n<p>Durante el avance del proyecto se han ido documentando algunas lecciones aprendidas en el siguiente blog. Estas pequeas notas documentan algunos de los problemas que pueden volver a aparecer. La mayora de estas publicaciones son relacionadas con problemas de arquitectura de software relacionados con el framework que se est utilizando, Django. Adems encontramos cdigo que permite automatizar la visualizacin de ciertos procesos que ayudan a optimzar el proceso de trabajo.</p>\n<ul>\n<li>blog-post 1</li>\n<li>blog-post 2</li>\n<li></li>\n</ul>'</div><div id="0-conclusiones"><h2>2</h2>b'<p>-- LINK_NOTE --</p>\n<p>[[conclusiones]]</p>\n<p>[[bibliografa]]</p>'</div><div id="conclusiones"><h3>3</h3>b'<p>Este trabajo se ha centrado en el desarrollo de un proceso de automatizacin que permite la integracin continua del flujo de trabajo del equipo. Hemos pasado por casi todas las etapas de diseo e implementacin adems de la final inclusin de los modelos predictivos para el cultivo.</p>\n<p>Revisamos el proceso ....</p>'</div><div id="bibliografía"><h3>3</h3>b'<p>http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/</p>\n<p>https://medium.com/@bonnotguillaume/software-architecture-the-pipeline-design-pattern-from-zero-to-hero-b5c43d8a4e60</p>\n<p>https://mermaid.js.org/syntax/entityRelationshipDiagram.html</p>\n<p>https://docs.djangoproject.com/en/4.1/intro/tutorial01/</p>\n<p>https://simpleisbetterthancomplex.com/tutorial/2018/08/27/how-to-create-custom-django-management-commands.html</p>\n<p>https://www.astera.com/es/type/blog/etl-pipeline-vs-data-pipeline/</p>\n<p>https://stackabuse.com/random-forest-algorithm-with-python-and-scikit-learn/</p>\n<p>https://towardsdatascience.com/random-forest-regression-5f605132d19d</p>\n<p>https://www.kaggle.com/code/sociopath00/random-forest-using-gridsearchcv</p>\n<p>https://plotly.com/python/knn-classification/</p>\n<p>https://scikit-learn.org/stable/auto_examples/miscellaneous/plot_pipeline_display.html#sphx-glr-auto-examples-miscellaneous-plot-pipeline-display-py</p>\n<p>https://scikit-learn.org/stable/modules/cross_validation.html</p>\n<p>https://towardsdatascience.com/ensemble-learning-using-scikit-learn-85c4531ff86a</p>\n<p>https://scikit-learn.org/stable/auto_examples/svm/plot_oneclass.html#sphx-glr-auto-examples-svm-plot-oneclass-py</p>'</div>
<div>
</div></div></body>
</html>
